# Codenames 游戏环境

## 概述

Codenames是一个基于词汇和联想的2v2团队游戏，测试玩家之间的沟通能力和词汇理解。每个团队由一名"密码主"(Spymaster)和一名"特工"(Operative)组成。密码主需要给出线索帮助特工找出属于自己团队的词语，同时避开对手词语、中立词语和刺客词。Codenames是Mind Games Challenge中"泛化赛道"(Generalization Track)的其中一个环境。

## 游戏规则

### 基本设置

1. **玩家**: 4名玩家，分为两个团队（红队和蓝队），每队有一名密码主和一名特工
2. **游戏板**: 25个随机词语，分配给不同类别:
   - 9个红队词语(R)
   - 8个蓝队词语(B)
   - 7个中立词语(N)
   - 1个刺客词语(A)
3. **角色**:
   - **密码主**: 可以看到所有词语的类别，负责给出线索
   - **特工**: 只能看到词语，不知道词语类别，根据线索猜词

### 游戏流程

1. **线索阶段**:
   - 密码主给出一个单词线索和一个数字(例如"风 2")
   - 单词线索不能是游戏板上的词或其子集
   - 数字表示与线索相关的团队词语数量

2. **猜词阶段**:
   - 特工根据线索猜测词语
   - 特工可以猜测最多(数字+1)个词
   - 如果猜错(猜到对手词、中立词或刺客词)，回合立即结束

3. **回合结束**:
   - 如果特工猜到刺客词，对手团队立即获胜
   - 如果特工猜到对手词或中立词，轮到对手团队
   - 如果特工用完所有猜测机会或选择停止(pass)，轮到对手团队

### 胜利条件

- 找出所有属于自己团队的词语的团队获胜
- 如果对手猜中刺客词，则自己团队获胜
- 如果对手误猜了己方最后一个词，则己方获胜

## 技术实现

Codenames环境在`envs/Codenames/env.py`文件中实现，主要类为`CodenamesEnv`。

### 初始化参数

```python
def __init__(self, hardcore: Optional[bool] = False):
```

- `hardcore`: 是否使用更大的词汇库（更难的游戏模式）

### 游戏状态

游戏状态包含以下关键信息:

```python
{
    "turn": 0,                # 当前回合
    "team_turn": 0,           # 当前行动的团队(0为红队，1为蓝队)
    "guessed_words": set(),   # 已经猜过的词语集合
    "last_clue": None,        # 最近一次给出的线索词
    "last_number": 0,         # 最近一次给出的线索数字
    "remaining_guesses": 0    # 当前特工剩余的猜测次数
}
```

### 关键方法

1. **`reset(num_players, seed)`**
   - 初始化游戏状态
   - 生成25个随机词语并分配类别
   - 设置初始提示

2. **`step(action)`**
   - 处理玩家动作并更新游戏状态
   - 根据玩家角色（密码主或特工）处理不同类型的动作

3. **`_render_player_view()`**
   - 根据玩家角色生成游戏板视图
   - 密码主可以看到所有词语类别
   - 特工只能看到已猜过的词语类别

4. **`_rotate_player_by_logic(done_guessing, skip_guessing)`**
   - 控制轮转到下一个玩家
   - 根据游戏逻辑确定下一个行动玩家

## 代理开发指南

### 观察格式

密码主接收的观察字符串包含以下信息:
```
Codenames Words:
word1    R 
word2    B 
word3    N 
...
```

特工接收的观察字符串只显示已猜过的词语类别:
```
Codenames Words:
word1    
word2    B revealed
word3    
...
```

### 动作格式

1. **密码主动作格式**:
   ```
   [word n]
   ```
   - `word`: 一个单词线索，不能是游戏板上的词或其子集
   - `n`: 与线索相关的团队词语数量

   例如: `[wind 2]`

2. **特工动作格式**:
   ```
   [word]
   ```
   - `word`: 猜测的词语，必须是游戏板上的词

   例如: `[breeze]`

   也可以选择放弃当前回合:
   ```
   [pass]
   ```

### 策略提示

#### 密码主策略

1. **高效线索**:
   - 寻找能够连接多个团队词语的线索
   - 优先考虑能涵盖更多词语的线索

2. **避免歧义**:
   - 避免可能导致特工误选刺客词或对手词的线索
   - 考虑已揭示的词语和游戏状态

3. **优先级**:
   - 如果对手接近胜利，考虑更保守的线索
   - 如果自己领先，可以冒更大风险给出涵盖更多词语的线索

4. **适应性调整**:
   - 根据特工的猜测能力调整线索的难度
   - 观察特工的思维模式并相应调整

#### 特工策略

1. **理解线索**:
   - 分析线索与游戏板上词语的所有可能联系
   - 考虑密码主的思维模式和之前的线索模式

2. **排除法**:
   - 排除已知不属于自己团队的词语
   - 对比线索与各个候选词的关联程度

3. **风险评估**:
   - 评估猜测错误的风险，尤其是可能是刺客词的情况
   - 在不确定时选择放弃(pass)

4. **观察对手**:
   - 从对手的线索和猜测中获取信息
   - 利用这些信息排除某些词语

## 示例

### 密码主观察示例

```
Codenames Words:
apple    R 
dog      B 
car      R 
house    N 
wind     B 
...
```

### 特工观察示例

```
Codenames Words:
apple    R revealed
dog      
car      
house    N revealed
wind     
...
```

### 密码主动作示例

```
[fruit 2]
```

### 特工动作示例

```
[apple]
```

或

```
[pass]
```

### 游戏流程示例

1. 红队密码主给出线索: `[fruit 2]`
2. 红队特工猜测: `[apple]` (正确，继续)
3. 红队特工猜测: `[banana]` (错误，是中立词)
4. 轮到蓝队...

## 总结

Codenames是一个测试沟通能力、词汇理解和推理能力的团队游戏。成功的代理需要具备强大的语言理解能力、逻辑推理能力和风险评估能力。密码主需要能够找到高效的词语关联，而特工需要准确理解线索并做出明智的猜测。
